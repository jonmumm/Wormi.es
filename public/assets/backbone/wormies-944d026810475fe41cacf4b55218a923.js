window.Wormies={Models:{},Collections:{},Routers:{},Views:{}},function(){this.JST||(this.JST={}),this.JST["backbone/templates/app"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push("");return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["backbone/templates/club"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<a href="#">\n  <img src="',volume.volumeInfo.imageLinks.thumbnail,'" class="thumbnail">\n</a>\n<div class="club-info">\n  <h3>',volume.volumeInfo.title,"</h3>\n  <h4>Hosted by <span>",admin_name,"</span></h4>\n  <p>\n    Starts <span>",new Date(start_time),'</span>\n  </p>\n  <p class="enter">\n    <a href="/clubs/',id,'">Enter this meeting Â»</a>\n  </p>\n</div>\n<div class="clear"></div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["backbone/templates/connectmodal"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div class="modal-header">\n  <h3>Connecting...</h3>\n</div>\n<div class="modal-body">\n  <p>Sit tight while you connect to the town hall.</p>\n</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["backbone/templates/panel"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push(""),app.get("is_moderator")?__p.push('\n  <button class="grn_btn startShowBtn" disabled="disabled">Start Event</button>\n  <button class="red_btn stopShowBtn" disabled="disabled">Stop Event</button>\n'):__p.push('\n  <button class="grn_btn joinShowBtn" disabled="disabled">Join Event</button>\n  <button class="red_btn leaveShowBtn" disabled="disabled">Leave Event</button>\n'),__p.push("\n");return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["backbone/templates/participant"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push('<div class="participant">\n  <div class="participant-wrapper">\n    <h3>Press <strong>Allow</strong></h3>\n    <div class="video">\n      <div id="videoContainer"></div>\n    </div>\n    <div class="buttons">\n      <div class="buttons-wrapper">\n        <a href="javascript:void(0)" class="red_btn remove">Remove</a>\n        <a href="javascript:void(0)" class="grn_btn tostage">Move to Stage</a>\n        <a href="javascript:void(0)" class="grn_btn offstage">Move off Stage</a>\n      </div>\n    </div>\n  </div>\n</div>\n');return __p.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["backbone/templates/volume"]=function(obj){var __p=[],print=function(){__p.push.apply(__p,arguments)};with(obj||{})__p.push("");return __p.join("")}}.call(this),Wormies.Models.App=Backbone.Model.extend({setup:function(){return this.set({participants:new Wormies.Collections.ParticipantCollection,events:new Wormies.Collections.EventManager})},start:function(){return this.get("session").connect(this.get("opentok_api_key"),this.get("opentok_token"))}}),Wormies.Models.Club=Backbone.Model.extend({initialize:function(){return $.ajax({url:"https://www.googleapis.com/books/v1/volumes/"+this.get("volume_id"),data:{key:"AIzaSyD5a1RmDzOb8csAUwc29uZhF7jdsL48yYI"},dataType:"jsonp",success:$.proxy(this.onGetVolume,this)})},onGetVolume:function(a){return this.set({volume:a})}}),Wormies.Collections.ClubCollection=Backbone.Collection.extend({model:Wormies.Models.Club}),Wormies.Models.Participant=Backbone.Model.extend({initialize:function(){return app.get("session").addEventListener("streamCreated",$.proxy(this.onStreamCreate,this))},defaults:{id:"myPublisher",state:"publish"},onStreamCreate:function(a){var b,c;c=a.streams[0];if(this.id==="myPublisher"&&c.connection.connectionId===app.get("session").connection.connectionId)return app.get("is_moderator")?b="host":b="queue",this.set({id:c.streamId,stream:c,state:b})}}),Wormies.Collections.ParticipantCollection=Backbone.Collection.extend({initialize:function(){return $(document).bind("startShow",$.proxy(this.onStartShow,this)),$(document).bind("stopShow",$.proxy(this.onStopShow,this)),$(document).bind("joinShow",$.proxy(this.onJoinShow,this)),$(document).bind("leaveShow",$.proxy(this.onLeaveShow,this)),$(document).bind("remove",$.proxy(this.onRemove,this)),app.get("session").addEventListener("sessionConnected",$.proxy(this.onSessionConnect,this)),app.get("session").addEventListener("streamCreated",$.proxy(this.onStreamCreate,this)),app.get("session").addEventListener("streamDestroyed",$.proxy(this.onStreamDestroy,this))},model:Wormies.Models.Participant,onStartShow:function(){return this.add(new Wormies.Models.Participant)},onStopShow:function(){},onJoinShow:function(){return this.add(new Wormies.Models.Participant)},onLeaveShow:function(){},onSessionConnect:function(a){var b,c,d,e,f;e=a.streams,f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(this.addParticipant(b));return f},onStreamCreate:function(a){var b,c,d,e,f;e=a.streams,f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(this.addParticipant(b));return f},onStreamDestroy:function(a){var b;return b=this.get(a.streams[0].streamId),this.remove(b)},onRemove:function(a,b){var c;return c=app.get("session"),c.forceUnpublish(b.id)},addParticipant:function(a){var b,c;if(a.connection.connectionId!==app.get("session").connection.connectionId)return b=app.get("events").get(a.streamId),b!=null?c=b.get("state"):c="queue",this.add(new Wormies.Models.Participant({id:a.streamId,stream:a,state:c}))}}),Wormies.Models.Volume=Backbone.Model.extend,Wormies.Views.AppView=Backbone.View.extend({template:JST["backbone/templates/app"],render:function(){var a,b,c;return a=new Wormies.Views.ConnectModalView,a.render(),b=new Wormies.Views.PanelView({el:$(".panel")}),b.render(),c=new Wormies.Views.StageView({el:$(".stage"),collection:app.get("participants")})}}),Wormies.Views.ClubListView=Backbone.View.extend({initialize:function(){return this.collection.bind("add",$.proxy(this.onClubAdd,this))},onClubAdd:function(a,b){var c,d;return c=$(this.make("li")),d=new Wormies.Views.ClubView({el:c,model:a}),c.appendTo(this.el)}}),Wormies.Views.ClubView=Backbone.View.extend({initialize:function(){return this.el.hide(),this.model.get("volume")!=null?this.render():this.model.bind("change",$.proxy(this.render,this))},template:JST["backbone/templates/club"],render:function(){return this.el.html(this.template(this.model.toJSON())),this.el.show("fast")}}),Wormies.Views.ConnectModalView=Backbone.View.extend({initialize:function(){return app.get("session").addEventListener("sessionConnected",$.proxy(this.onSessionConnect,this)),app.get("session").addEventListener("exception",$.proxy(this.onException,this))},template:JST["backbone/templates/connectmodal"],render:function(){return this.el=$(this.make("div",{id:"connectModal","class":"modal hide fade"})),this.el.html(this.template),this.el.appendTo("body"),this.el.modal({backdrop:!0,show:!0})},onSessionConnect:function(){return this.el.modal("hide")},onException:function(a){return $(".modal-header h3",this.el).text(a.title),$(".modal-body p",this.el).text(a.message)}}),Wormies.Views.PanelView=Backbone.View.extend({initialize:function(){return app.get("session").addEventListener("sessionConnected",this.onSessionConnect)},template:JST["backbone/templates/panel"],render:function(){return this.el.html(this.template)},onSessionConnect:function(){return $(".startShowBtn").removeAttr("disabled"),$(".joinShowBtn").removeAttr("disabled")},events:{"click .startShowBtn":"onStartShowClick","click .stopShowBtn":"onStopShowClick","click .joinShowBtn":"onJoinShowClick","click .leaveShowBtn":"onLeaveShowClick"},onStartShowClick:function(){return $(document).trigger("startShow"),$(".startShowBtn").attr("disabled","disabled"),$(".stopShowBtn").removeAttr("disabled")},onStopShowClick:function(){return $(document).trigger("stopShow"),$(".stopShowBtn").attr("disabled","disabled")},onJoinShowClick:function(){return $(document).trigger("joinShow"),$(".joinShowBtn").attr("disabled","disabled"),$(".leaveShowBtn").removeAttr("disabled")},onLeaveShowClick:function(){return $(document).trigger("leaveShow"),$(".leaveShowBtn").attr("disabled","disabled")}}),Wormies.Views.ParticipantView=Backbone.View.extend({initialize:function(){return this.model.bind("change:id",$.proxy(this.onIdChange,this)),this.model.bind("change:state",$.proxy(this.onStateChange,this))},template:JST["backbone/templates/participant"],events:{"click .remove":"onRemoveClick","click .tostage":"onToStageClick","click .offstage":"offStageClick"},onRemoveClick:function(){return $(document).trigger("remove",this.model)},onToStageClick:function(){return $(document).trigger("toStage",this.model)},offStageClick:function(){return $(document).trigger("offStage",this.model)},onIdChange:function(a){return this.el.attr("id",a.id)},onStateChange:function(a,b){return this.el.removeClass(),this.el.addClass(a.get("state")),this.setAudioSubscribe()},render:function(){var a;return this.el.html(this.template),this.model.get("stream")?(a=app.get("session").subscribe(this.model.get("stream"),"videoContainer"),this.model.set({subscriber:a}),this.setAudioSubscribe()):app.get("session").publish("videoContainer")},setAudioSubscribe:function(){var a;a=this.model.get("subscriber");if(a!=null)return this.model.get("state")==="guest"||this.model.get("state")==="host"?this.model.get("subscriber").subscribeToAudio(!0):this.model.get("subscriber").subscribeToAudio(!1)}}),Wormies.Views.StageView=Backbone.View.extend({initialize:function(){return this.collection.bind("add",$.proxy(this.onParticipantAdd,this)),this.collection.bind("remove",$.proxy(this.onParticipantRemove,this))},onParticipantAdd:function(a){var b,c;return b=$(this.make("div",{id:a.get("id"),"class":a.get("state")})),b.appendTo(this.el),c=new Wormies.Views.ParticipantView({el:b,model:a}),c.render()},onParticipantRemove:function(a){return $("#"+a.get("id")).remove()}})